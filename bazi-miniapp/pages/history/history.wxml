<!-- pages/history/history.wxml -->
<view class="container">

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{!isEmpty}}">
    <view
      class="record-item"
      wx:for="{{records}}"
      wx:key="id"
      bindtap="onViewDetail"
      data-record="{{item}}"
    >
      <view class="record-header">
        <view class="record-name">
          <text class="name-text">{{item.name || 'æœªå‘½å'}}</text>
          <text class="gender-badge">{{item.gender === 1 ? 'ç”·' : 'å¥³'}}</text>
        </view>
        <view class="record-date">
          <text class="date-text">{{item.solar}}</text>
        </view>
      </view>

      <view class="record-bazi">
        <view class="bazi-item">
          <text class="bazi-label">å¹´æŸ±</text>
          <text class="bazi-value">{{item.ganzhi.year}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">æœˆæŸ±</text>
          <text class="bazi-value">{{item.ganzhi.month}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">æ—¥æŸ±</text>
          <text class="bazi-value">{{item.ganzhi.day}}</text>
        </view>
        <view class="bazi-item">
          <text class="bazi-label">æ—¶æŸ±</text>
          <text class="bazi-value">{{item.ganzhi.hour}}</text>
        </view>
      </view>

      <view class="record-footer">
        <view class="record-time">
          <text class="time-icon">ğŸ•</text>
          <text class="time-text">{{item.createdAt || item.created_at}}</text>
        </view>
        <view class="record-actions" catchtap="onDeleteRecord" data-id="{{item.id}}" data-index="{{index}}">
          <text class="delete-icon">ğŸ—‘ï¸</text>
          <text class="delete-text">åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loading && !isEmpty}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view class="no-more" wx:if="{{!hasMore && !isEmpty && records.length > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isEmpty && !loading}}">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
    <text class="empty-desc">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡å…«å­—æ’ç›˜å§</text>
    <button class="empty-btn" bindtap="onStartNew">å¼€å§‹æ’ç›˜</button>
  </view>

</view>
