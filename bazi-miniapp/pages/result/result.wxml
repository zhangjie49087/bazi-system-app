<!-- pages/result/result.wxml -->
<view class="container" wx:if="{{result}}">

  <!-- é¡¶éƒ¨è£…é¥° -->
  <view class="header-decoration">
    <!-- TODO: å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è£…é¥°æ€§å›¾ç‰‡æˆ–logo -->
    <view class="decoration-circle"></view>
    <view class="decoration-circle"></view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
  <view class="info-card card">
    <view class="card-header">
      <text class="card-title">åŸºæœ¬ä¿¡æ¯</text>
    </view>
    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">å§“å</text>
        <text class="info-value">{{result.name || 'æœªå¡«å†™'}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ€§åˆ«</text>
        <text class="info-value">{{result.gender === 1 ? 'ç”·' : 'å¥³'}}</text>
      </view>
      <view class="info-item full-width">
        <text class="info-label">å…¬å†</text>
        <text class="info-value">{{result.solar}}</text>
      </view>
      <view class="info-item full-width">
        <text class="info-label">å†œå†</text>
        <text class="info-value">{{result.lunar}}</text>
      </view>
    </view>
  </view>

  <!-- å››æŸ±å…«å­—å¡ç‰‡ -->
  <view class="bazi-card card">
    <view class="card-header">
      <text class="card-title">å››æŸ±å…«å­—</text>
      <text class="card-subtitle">å¹´æŸ± æœˆæŸ± æ—¥æŸ± æ—¶æŸ±</text>
    </view>

    <view class="bazi-table">
      <!-- è¡¨å¤´ -->
      <view class="bazi-row header-row">
        <view class="bazi-cell">å¹´æŸ±</view>
        <view class="bazi-cell">æœˆæŸ±</view>
        <view class="bazi-cell">æ—¥æŸ±</view>
        <view class="bazi-cell">æ—¶æŸ±</view>
      </view>

      <!-- å¤©å¹² -->
      <view class="bazi-row">
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.year.gan)}}">
          <text class="gan-text">{{result.ganzhiDetail.year.gan}}</text>
          <text class="wx-text">{{result.wuxing.year.gan}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.month.gan)}}">
          <text class="gan-text">{{result.ganzhiDetail.month.gan}}</text>
          <text class="wx-text">{{result.wuxing.month.gan}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.day.gan)}}">
          <text class="gan-text">{{result.ganzhiDetail.day.gan}}</text>
          <text class="wx-text">{{result.wuxing.day.gan}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.hour.gan)}}">
          <text class="gan-text">{{result.ganzhiDetail.hour.gan}}</text>
          <text class="wx-text">{{result.wuxing.hour.gan}}</text>
        </view>
      </view>

      <!-- åœ°æ”¯ -->
      <view class="bazi-row">
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.year.zhi)}}">
          <text class="zhi-text">{{result.ganzhiDetail.year.zhi}}</text>
          <text class="wx-text">{{result.wuxing.year.zhi}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.month.zhi)}}">
          <text class="zhi-text">{{result.ganzhiDetail.month.zhi}}</text>
          <text class="wx-text">{{result.wuxing.month.zhi}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.day.zhi)}}">
          <text class="zhi-text">{{result.ganzhiDetail.day.zhi}}</text>
          <text class="wx-text">{{result.wuxing.day.zhi}}</text>
        </view>
        <view class="bazi-cell {{getWuxingBgClass(result.wuxing.hour.zhi)}}">
          <text class="zhi-text">{{result.ganzhiDetail.hour.zhi}}</text>
          <text class="wx-text">{{result.wuxing.hour.zhi}}</text>
        </view>
      </view>

      <!-- çº³éŸ³ -->
      <view class="bazi-row nayin-row">
        <view class="bazi-cell">{{result.nayin.year}}</view>
        <view class="bazi-cell">{{result.nayin.month}}</view>
        <view class="bazi-cell">{{result.nayin.day}}</view>
        <view class="bazi-cell">{{result.nayin.hour}}</view>
      </view>
    </view>
  </view>

  <!-- åç¥é…ç½®å¡ç‰‡ -->
  <view class="shishen-card card">
    <view class="card-header">
      <text class="card-title">åç¥é…ç½®</text>
    </view>

    <view class="shishen-table">
      <view class="shishen-row">
        <view class="shishen-label">å¤©å¹²</view>
        <view class="shishen-cell">{{result.shishen.year.gan}}</view>
        <view class="shishen-cell">{{result.shishen.month.gan}}</view>
        <view class="shishen-cell highlight">{{result.shishen.day.gan}}</view>
        <view class="shishen-cell">{{result.shishen.hour.gan}}</view>
      </view>
      <view class="shishen-row">
        <view class="shishen-label">åœ°æ”¯</view>
        <view class="shishen-cell">{{result.shishen.year.zhi}}</view>
        <view class="shishen-cell">{{result.shishen.month.zhi}}</view>
        <view class="shishen-cell">{{result.shishen.day.zhi}}</view>
        <view class="shishen-cell">{{result.shishen.hour.zhi}}</view>
      </view>
    </view>
  </view>

  <!-- ç¥ç…ä¿¡æ¯å¡ç‰‡ -->
  <view class="shensha-card card" wx:if="{{result.shensha}}">
    <view class="card-header">
      <text class="card-title">ç¥ç…ä¿¡æ¯</text>
    </view>

    <view class="shensha-list">
      <view class="shensha-item" wx:if="{{result.shensha.year.length > 0}}">
        <text class="shensha-label">å¹´æŸ±</text>
        <view class="shensha-tags">
          <text class="shensha-tag" wx:for="{{result.shensha.year}}" wx:key="index">{{item}}</text>
        </view>
      </view>

      <view class="shensha-item" wx:if="{{result.shensha.month.length > 0}}">
        <text class="shensha-label">æœˆæŸ±</text>
        <view class="shensha-tags">
          <text class="shensha-tag" wx:for="{{result.shensha.month}}" wx:key="index">{{item}}</text>
        </view>
      </view>

      <view class="shensha-item" wx:if="{{result.shensha.day.length > 0}}">
        <text class="shensha-label">æ—¥æŸ±</text>
        <view class="shensha-tags">
          <text class="shensha-tag" wx:for="{{result.shensha.day}}" wx:key="index">{{item}}</text>
        </view>
      </view>

      <view class="shensha-item" wx:if="{{result.shensha.hour.length > 0}}">
        <text class="shensha-label">æ—¶æŸ±</text>
        <view class="shensha-tags">
          <text class="shensha-tag" wx:for="{{result.shensha.hour}}" wx:key="index">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- äº”è¡Œç»Ÿè®¡å¡ç‰‡ -->
  <view class="wuxing-card card">
    <view class="card-header">
      <text class="card-title">äº”è¡Œç»Ÿè®¡</text>
    </view>

    <view class="wuxing-stats">
      <view class="wuxing-item" wx:for="{{wuxingList}}" wx:key="name">
        <view class="wuxing-info">
          <text class="wuxing-name {{getWuxingClass(item.name)}}">{{item.name}}</text>
          <text class="wuxing-count">{{item.count}}</text>
        </view>
        <view class="wuxing-bar">
          <view class="wuxing-fill {{getWuxingBgClass(item.name)}}" style="width: {{item.percent}}%"></view>
        </view>
        <text class="wuxing-percent">{{item.percent}}%</text>
      </view>
    </view>

    <view class="wuxing-lack" wx:if="{{lackWuxing.length > 0}}">
      <text class="lack-icon">âš ï¸</text>
      <text class="lack-text">äº”è¡Œç¼º{{lackWuxing.join('ã€')}}</text>
    </view>
  </view>

  <!-- å‘½ç†åˆ†æå¡ç‰‡ -->
  <view class="analysis-card card">
    <view class="card-header">
      <text class="card-title">å‘½ç†åˆ†æ</text>
    </view>

    <!-- æ—¥ä¸»å‘½å±€ -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">ğŸ¯</text>
        <text class="section-title">æ—¥ä¸»å‘½å±€</text>
      </view>
      <view class="section-content">
        <text class="highlight-text">æ—¥ä¸»ï¼š{{result.dayGan}}ï¼ˆ{{result.dayGanWuxing}}ï¼‰</text>
        <text class="normal-text">{{result.mingju}}</text>
      </view>
    </view>

    <!-- ç»¼åˆåˆ†æ -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">ğŸ“Š</text>
        <text class="section-title">ç»¼åˆåˆ†æ</text>
      </view>
      <view class="section-content">
        <text class="normal-text">{{result.analysis.summary}}</text>
      </view>
    </view>

    <!-- äº”è¡Œåˆ†æ -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">âš–ï¸</text>
        <text class="section-title">äº”è¡Œåˆ†æ</text>
      </view>
      <view class="section-content">
        <text class="normal-text">{{result.analysis.wuxingAnalysis}}</text>
      </view>
    </view>

    <!-- æ€§æ ¼ç‰¹ç‚¹ -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">ğŸ‘¤</text>
        <text class="section-title">æ€§æ ¼ç‰¹ç‚¹</text>
      </view>
      <view class="section-content">
        <text class="normal-text">{{result.analysis.personality}}</text>
      </view>
    </view>

    <!-- äº‹ä¸šå»ºè®® -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">ğŸ’¼</text>
        <text class="section-title">äº‹ä¸šå»ºè®®</text>
      </view>
      <view class="section-content">
        <text class="normal-text">{{result.analysis.career}}</text>
      </view>
    </view>

    <!-- å¥åº·æç¤º -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-icon">â¤ï¸</text>
        <text class="section-title">å¥åº·æç¤º</text>
      </view>
      <view class="section-content">
        <text class="normal-text">{{result.analysis.health}}</text>
      </view>
    </view>
  </view>

  <!-- å¤§è¿ä¿¡æ¯å¡ç‰‡ -->
  <view class="dayun-card card" wx:if="{{result.dayun && result.dayun.length > 0}}">
    <view class="card-header">
      <text class="card-title">å¤§è¿ä¿¡æ¯</text>
      <text class="card-subtitle">å‰äº”ä¸ªå¤§è¿</text>
    </view>

    <view class="dayun-list">
      <view class="dayun-item" wx:for="{{result.dayun}}" wx:key="age" wx:if="{{index < 5}}">
        <view class="dayun-age">{{item.age}}</view>
        <view class="dayun-ganzhi">{{item.ganzhi}}</view>
        <view class="dayun-year">{{item.startYear}}å¹´èµ·</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn" bindtap="onBackHome">
      <text class="btn-icon">ğŸ </text>
      <text class="btn-text">è¿”å›é¦–é¡µ</text>
    </button>
    <button class="action-btn" bindtap="onViewHistory">
      <text class="btn-icon">ğŸ“œ</text>
      <text class="btn-text">æŸ¥çœ‹å†å²</text>
    </button>
    <button class="action-btn" open-type="share" bindtap="onShare">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">åˆ†äº«</text>
    </button>
  </view>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <view class="footer-note">
    <text class="note-text">* ä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒï¼Œå…·ä½“æƒ…å†µéœ€ç»“åˆæ•´ä½“å‘½å±€ç»¼åˆåˆ¤æ–­</text>
  </view>

</view>

<!-- åŠ è½½å¤±è´¥æç¤º -->
<view class="empty-state" wx:else>
  <text class="empty-icon">ğŸ˜•</text>
  <text class="empty-text">æ•°æ®åŠ è½½å¤±è´¥</text>
  <button class="empty-btn" bindtap="onBackHome">è¿”å›é¦–é¡µ</button>
</view>
